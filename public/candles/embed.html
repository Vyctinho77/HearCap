<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HearCap Candles Embed</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%238f7bff'/%3E%3Cstop offset='1' stop-color='%2300ff80'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect x='4' y='4' width='56' height='56' rx='14' fill='%230b0a14'/%3E%3Crect x='18' y='18' width='6' height='28' rx='2' fill='url(%23g)'/%3E%3Crect x='30' y='14' width='6' height='32' rx='2' fill='url(%23g)'/%3E%3Crect x='42' y='22' width='6' height='24' rx='2' fill='url(%23g)'/%3E%3C/svg%3E" />
    <link rel="stylesheet" href="./styles.css" />
    <link rel="stylesheet" href="./styles/drawing-toolbar.css" />
    <link rel="stylesheet" href="./embed.css" />
  </head>
  <body>
    <main class="app">
      <section class="chart-blueprint">
        <header class="chart-header">
          <div class="chart-header-left">
            <div class="chart-avatar asset-profile__avatar" aria-hidden="true"></div>
            <div class="chart-header-info">
              <p class="asset-profile__label asset-profile__label--artist">HearCap Sessions</p>
              <p class="asset-profile__label asset-profile__label--token">Token HRCP-AUR</p>
              <p class="asset-profile__label asset-profile__label--price">Preço médio ~ R$ 148,00</p>
            </div>
          </div>
          <div class="chart-header-right">
            <div class="chart-visual-mode" role="group" aria-label="Nível do gráfico">
              <button class="chart-visual-mode__button" type="button" data-visual-mode="basic" aria-pressed="false">
                Modo Básico
              </button>
              <button
                class="chart-visual-mode__button chart-visual-mode__button--active"
                type="button"
                data-visual-mode="advanced"
                aria-pressed="true"
              >
                Modo Avançado
              </button>
            </div>
          </div>
        </header>
        <div class="chart-blueprint__body">
          <div class="chart-config-row">
            <div class="chart-timeframes" role="group" aria-label="Intervalo do gráfico">
              <button
                class="chart-timeframe__button chart-timeframe__button--active"
                type="button"
                data-timeframe="1m"
                aria-pressed="true"
              >
                1m
              </button>
              <button class="chart-timeframe__button" type="button" data-timeframe="5m" aria-pressed="false">
                5m
              </button>
              <button class="chart-timeframe__button" type="button" data-timeframe="15m" aria-pressed="false">
                15m
              </button>
              <button class="chart-timeframe__button" type="button" data-timeframe="1h" aria-pressed="false">
                1h
              </button>
              <button class="chart-timeframe__button" type="button" data-timeframe="4h" aria-pressed="false">
                4h
              </button>
              <button class="chart-timeframe__button" type="button" data-timeframe="1d" aria-pressed="false">
                1d
              </button>
            </div>
            <div class="chart-modes" role="group" aria-label="Tipo de gráfico">
              <button
                class="chart-mode__button chart-mode__button--active"
                type="button"
                data-chart-mode="candles"
                aria-pressed="true"
              >
                Velas
              </button>
              <button class="chart-mode__button" type="button" data-chart-mode="line" aria-pressed="false">
                Linha
              </button>
              <button class="chart-mode__button" type="button" data-chart-mode="area" aria-pressed="false">
                Área
              </button>
            </div>
          </div>
          <div class="chart-main">
            <div class="chart-stage">
              <div class="chart-toolbar" aria-label="Ferramentas de desenho">
                <button type="button" class="chart-toolbar__button" data-tool="trendline-pro">TL</button>
                <button type="button" class="chart-toolbar__button" data-tool="fibonacci">FIB</button>
                <button type="button" class="chart-toolbar__button" data-tool="hline">HL</button>
                <button type="button" class="chart-toolbar__button" data-tool="vline">VL</button>
                <button type="button" class="chart-toolbar__button" data-tool="rect">R</button>
                <button type="button" class="chart-toolbar__button" data-tool="none">?</button>
                <div class="chart-toolbar__divider" role="presentation"></div>
                <button type="button" class="chart-toolbar__button chart-toolbar__button--action" data-action="delete">
                  DEL
                </button>
                <button
                  type="button"
                  class="chart-toolbar__button chart-toolbar__button--action"
                  data-action="duplicate"
                >
                  DUP
                </button>
                <button type="button" class="chart-toolbar__button chart-toolbar__button--action" data-action="clear">
                  CLR
                </button>
              </div>
              <div class="chart-canvas">
                <canvas id="chart" class="chart-layer"></canvas>
                <canvas id="chart-overlay" class="chart-layer"></canvas>
                <canvas id="drawing-layer" class="chart-layer"></canvas>
                <button class="indicator-toggle-button" id="toggle-indicators" type="button">
                  ?? Ocultar Indicadores
                </button>
                <div class="chart-overlays">
                  <button class="live-badge" id="follow-button" type="button" aria-hidden="true" aria-pressed="true">
                    AO VIVO
                  </button>
                  <button class="cinema-mode-btn" id="toggle-cinema-mode" type="button">Cinema Mode</button>
                </div>
                <div class="tooltip" id="tooltip"></div>
              </div>
            </div>
            <div class="chart-price-scale" role="presentation">
              <canvas id="price-scale"></canvas>
            </div>
          </div>
        </div>
      </section>
    </main>
    <script type="module" src="./src/main.js"></script>
    <script>
      (function () {
        const params = new URLSearchParams(window.location.search);
        const artist = params.get('artist') || 'HearCap Sessions';
        const token = params.get('token') || 'HRCP-AUR';
        const priceRaw = params.get('price');
        const change = params.get('change');
        const availability = params.get('availability');
        const avatar = params.get('avatar');

        const artistEl = document.querySelector('.asset-profile__label--artist');
        const tokenEl = document.querySelector('.asset-profile__label--token');
        const priceEl = document.querySelector('.asset-profile__label--price');
        const avatarEl = document.querySelector('.asset-profile__avatar');

        if (artistEl) artistEl.textContent = artist;
        if (tokenEl) tokenEl.textContent = `Token ${token}`;

        if (priceEl) {
          let priceText = 'Preço médio';
          if (priceRaw && !isNaN(Number(priceRaw))) {
            const formatted = Number(priceRaw).toLocaleString('pt-BR', {
              style: 'currency',
              currency: 'USD',
              minimumFractionDigits: 2,
            });
            priceText = `${formatted}`;
          }
          if (change) {
            priceText += ` (${change})`;
          }
          if (availability) {
            priceText += ` · Vol ${availability}`;
          }
          priceEl.textContent = priceText;
        }

        if (avatarEl) {
          if (avatar) {
            avatarEl.style.backgroundImage = `url(${decodeURIComponent(avatar)})`;
            avatarEl.style.backgroundSize = 'cover';
            avatarEl.style.backgroundPosition = 'center';
            avatarEl.style.border = '2px solid rgba(255,255,255,0.15)';
          } else {
            avatarEl.style.background = 'linear-gradient(135deg, #7c3aed, #9333ea)';
          }
        }
      })();
    </script>
  </body>
</html>
